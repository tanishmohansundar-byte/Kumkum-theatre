<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kumkum Theatre</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: #f2f2f7; 
      color: #222; 
      display: flex; 
      justify-content: center; 
      align-items: center; 
      min-height: 100vh; 
    }
    .container { 
      text-align: center; 
      padding: 30px; 
      background: #fff; 
      border-radius: 12px; 
      box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
      width: 90%; 
      max-width: 650px;
    }
    h1, h2 { margin-bottom: 20px; }
    button { 
      padding: 12px 20px; 
      margin: 10px; 
      border: none; 
      border-radius: 8px; 
      background: #ffcc00; 
      font-size: 16px; 
      cursor: pointer; 
      display: block; 
      margin-left: auto; 
      margin-right: auto; 
      width: fit-content;
    }
    button:hover { background: #ffaa00; }

    /* üéü Date bar sticky */
    .date-bar {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      margin: 20px 0;
      padding: 10px;
      position: sticky;
      top: 0;
      background: #fff;
      z-index: 10;
      border-bottom: 2px solid #ddd;
    }
    .date-btn {
      flex: 0 0 auto;
      padding: 12px 15px;
      background: #ddd;
      border-radius: 10px;
      cursor: pointer;
      border: none;
      font-size: 14px;
    }
    .date-btn.active {
      background: #ffcc00;
      font-weight: bold;
    }

    /* üé¨ Seats */
    .seat-grid { 
      display: grid; 
      grid-template-columns: repeat(10, 1fr); 
      gap: 5px; 
      justify-content: center; 
      margin-top: 20px; 
    }
    .seat { 
      padding: 10px; 
      border-radius: 6px; 
      border: 1px solid #333; 
      cursor: pointer; 
      background: #eee; 
      text-align: center;
    }
    .seat.selected { background: #4caf50; color: white; }
    .screen { 
      width: 80%; 
      margin: 0 auto 20px; 
      padding: 10px; 
      background: #333; 
      color: white; 
      border-radius: 8px; 
    }

    /* üçø Snacks */
    .snack-item { margin: 10px 0; }
    input[type="number"] { width: 60px; padding: 5px; margin-left: 10px; }

    /* üì± QR */
    .qr-container { margin-top: 20px; }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    const app = document.getElementById("app");

    // üé¨ Movies
    const movies = [
      { title: "Maruthuvar" },
      { title: "Spy" },
      { title: "Jai Bhim" },
      { title: "Naidus Padam" },
      { title: "Detective" },
      { title: "Johnson Ducknail" },
      { title: "Mixed Emotions" },
      { title: "Sorus" },
      { title: "DD" }
    ];

    // üìÖ Generate 7 days dynamically
    const today = new Date();
    const dates = Array.from({length: 7}, (_, i) => {
      const d = new Date();
      d.setDate(today.getDate() + i);
      return d;
    });

    // üéüÔ∏è Shows
    const showTemplates = [
      { time: "10:00 AM", screen: "Standard" },
      { time: "1:00 PM", screen: "3D" },
      { time: "5:00 PM", screen: "IMAX" },
      { time: "9:00 PM", screen: "LUXE" }
    ];

    const beverages = [
      { name: "Popcorn", price: 100 },
      { name: "Coca Cola", price: 80 },
      { name: "Pepsi", price: 80 },
      { name: "French Fries", price: 120 },
      { name: "Nachos", price: 150 },
      { name: "Magnum Ice Cream", price: 200 }
    ];

    let selectedDate = null;
    let selectedMovie = null;
    let selectedShow = null;
    let selectedSeats = [];
    let selectedSnacks = {};
    let historyStack = [];

    function navigate(screenFn) {
      historyStack.push(screenFn);
      screenFn();
    }

    function goBack() {
      historyStack.pop();
      if (historyStack.length > 0) {
        historyStack[historyStack.length - 1]();
      } else {
        loadWelcome();
      }
    }

    function loadWelcome() {
      historyStack = [];
      app.innerHTML = `
        <div class="container">
          <h1>Welcome to Kumkum Theatre üé•</h1>
          <button onclick="navigate(loadDates)">Book Now</button>
        </div>
      `;
    }

    function loadDates() {
      app.innerHTML = `<div class="container"><h2>Select Date</h2><div class="date-bar">`;
      dates.forEach((d, i) => {
        const label = i === 0 ? "Today" : i === 1 ? "Tomorrow" : d.toDateString().slice(0, 10);
        app.innerHTML += `<button class="date-btn ${i===0?"active":""}" onclick="selectDate(${i}, this)">${label}</button>`;
      });
      app.innerHTML += `</div><button onclick="goBack()">‚¨Ö Back</button></div>`;
      selectedDate = dates[0].toDateString(); // default "Today"
    }

    function selectDate(i, el) {
      selectedDate = dates[i].toDateString();
      document.querySelectorAll(".date-btn").forEach(b => b.classList.remove("active"));
      el.classList.add("active");
      navigate(loadMovies);
    }

    function loadMovies() {
      app.innerHTML = `<div class="container"><h2>Select Movie</h2>`;
      movies.forEach((m, i) => {
        app.innerHTML += `<button onclick="selectMovie(${i})">${m.title}</button>`;
      });
      app.innerHTML += `<button onclick="goBack()">‚¨Ö Back</button></div>`;
    }

    function selectMovie(i) {
      selectedMovie = movies[i];
      navigate(loadShowTimings);
    }

    function loadShowTimings() {
      app.innerHTML = `<div class="container"><h2>Shows for ${selectedMovie.title} on ${selectedDate}</h2>`;
      showTemplates.forEach((s, i) => {
        app.innerHTML += `<button onclick="selectShow(${i})">${s.time} - ${s.screen}</button>`;
      });
      app.innerHTML += `<button onclick="goBack()">‚¨Ö Back</button></div>`;
    }

    function selectShow(i) {
      selectedShow = showTemplates[i];
      navigate(loadSeatSelection);
    }

    function loadSeatSelection() {
      selectedSeats = [];
      app.innerHTML = `<div class="container"><h2>Select Seats (${selectedShow.screen})</h2>`;
      app.innerHTML += `<div class="screen">SCREEN</div>`;
      app.innerHTML += `<div class="seat-grid">`;
      for (let i = 1; i <= 40; i++) {
        let price = i <= 20 ? 350 : 200;
        app.innerHTML += `<div class="seat" onclick="toggleSeat(${i}, ${price}, this)">S${i}<br>${price}</div>`;
      }
      app.innerHTML += `</div>`;
      app.innerHTML += `<button onclick="navigate(loadSnacks)">Continue</button>`;
      app.innerHTML += `<button onclick="goBack()">‚¨Ö Back</button></div>`;
    }

    function toggleSeat(seat, price, el) {
      const index = selectedSeats.findIndex(s => s.num === seat);
      if (index >= 0) {
        selectedSeats.splice(index, 1);
        el.classList.remove("selected");
      } else {
        selectedSeats.push({ num: seat, price });
        el.classList.add("selected");
      }
    }

    function loadSnacks() {
      selectedSnacks = {};
      app.innerHTML = `<div class="container"><h2>Snacks & Beverages</h2>`;
      beverages.forEach((b, i) => {
        app.innerHTML += `
          <div class="snack-item">
            ${b.name} (${b.price} lators) 
            <input type="number" id="snack-${i}" min="0" value="0" onchange="updateSnack(${i}, this.value)">
          </div>
        `;
      });
      app.innerHTML += `<button onclick="navigate(loadConfirmation)">Proceed to Confirmation</button>`;
      app.innerHTML += `<button onclick="goBack()">‚¨Ö Back</button></div>`;
    }

    function updateSnack(i, qty) {
      if (qty > 0) {
        selectedSnacks[beverages[i].name] = { ...beverages[i], qty: parseInt(qty) };
      } else {
        delete selectedSnacks[beverages[i].name];
      }
    }

    function loadConfirmation() {
      let seatTotal = selectedSeats.reduce((sum, s) => sum + s.price, 0);

      let snackTotal = 0;
      let snackList = "";
      Object.values(selectedSnacks).forEach(s => {
        snackTotal += s.price * s.qty;
        snackList += `${s.name} x${s.qty}, `;
      });

      let total = seatTotal + snackTotal;

      app.innerHTML = `
        <div class="container">
          <h2>Booking Confirmation üéüÔ∏è</h2>
          <p><strong>Date:</strong> ${selectedDate}</p>
          <p><strong>Movie:</strong> ${selectedMovie.title}</p>
          <p><strong>Show:</strong> ${selectedShow.time} (${selectedShow.screen})</p>
          <p><strong>Seats:</strong> ${selectedSeats.map(s => `S${s.num} (${s.price})`).join(", ")}</p>
          <p><strong>Snacks:</strong> ${snackList || "None"}</p>
          <h3>Total: ${total} lators</h3>
          <div class="qr-container">
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(
              "Kumkum Theatre - " + selectedMovie.title + " - " + selectedShow.time
            )}" alt="QR Code"/>
          </div>
          <p>Scan QR code at theatre entrance!</p>
          <button onclick="loadWelcome()">üîÑ Restart</button>
        </div>
      `;
    }

    loadWelcome();
  </script>
</body>
</html>
